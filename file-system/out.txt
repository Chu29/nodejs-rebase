"USE STRICT";
CONST { PIPELINE } = REQUIRE("NODE:STREAM");
CONST { JOIN } = REQUIRE("NODE:PATH");
CONST { CREATEREADSTREAM, CREATEWRITESTREAM } = REQUIRE("NODE:FS");
CONST { TRANSFORM } = REQUIRE("NODE:STREAM");

CONST CREATEUPPERCASESTREAM = () => {
  RETURN NEW TRANSFORM({
    TRANSFORM(CHUNK, ENC, NEXT) {
      CONST UPPERCASED = CHUNK.TOSTRING().TOUPPERCASE();
      NEXT(NULL, UPPERCASED);
    },
  });
};

PIPELINE(
  CREATEREADSTREAM(__FILENAME),
  CREATEUPPERCASESTREAM(),
  CREATEWRITESTREAM(JOIN(__DIRNAME, "OUT.TXT")),
  (ERR) => {
    IF (ERR) {
      CONSOLE.ERROR(ERR);
      RETURN;
    }
    CONSOLE.LOG("FINISHED WRITING");
  },
);
